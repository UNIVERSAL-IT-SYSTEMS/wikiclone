This guide has been shamelessly copied from the [https://wiki.kubuntu.org/OneiricOcelot/Final/Kubuntu/Kmail2 Ubuntu Wiki]. Please improve and adapt it for Gentoo!

= Introduction =
With KDEPIM-4.6 and 4.7, KDE's Personal Information Management suite, Kontact, has seen a major move to the new Akonadi system. This will mean any users of previous versions of of the PIM software will need to have their data migrated to the new system. This includes contacts from KAddressBook, events from KOrganizer, and email messages and accounts from KMail. Unfortunately, this process does not work automatically at this time, and may not be 100% successful when it is perfomed manually.

On the initial startup of the new KDE PIM suite, the address book and calendar data will be migrated automatically.

= Backing Up =
The move to KMail2 means that email accounts and information are now also using Akonadi's storage and data system. The migration process for this will occur when KMail or Kontact is first run, and can be skipped for those who prefer to create their accounts manually. Unfortunately, at this time, the migration tool [[Bug:857828|does not properly run]] when you select the Migrate option.

For this reason, it is highly advised that users back up their PIM data '''before''' running KMail after upgrading. It also may be advisable for some to skip the migration process and recreate their accounts from scratch.

To back up your data, make copies of these files and folders:

 * ~/.kde4/share/apps/kmail       - This is where your emails are stored<<BR>>~/Mail  - Used by (very) old Kmail versions. (Still used when found).
 * ~/.kde4/share/apps/korganizer  - Your calendar data is here.
 * ~/.kde4/share/apps/kabc        - Contacts are kept here.
With these saved folders, it will be possible to import the data into Kontact should the need arise.

 * ~/.kde4/share/config/kmailrc
 * ~/.kde4/share/config/kaddressbookrc
 * ~/.kde4/share/config/korganizerrc
 * ~/.kde4/share/config/emailidentities
 * ~/.kde4/share/config/emaildefaults
 * ~/.kde4/share/config/kmailrc
 * ~/.kde4/share/config/mailtransports
These are the basic config files for the various Kontact applications.
More information on what you may want to back up can be found [[http://userbase.kde.org/KMail/FAQs_Hints_and_Tips#Transfer_mail_and_settings_to_another_computer_.28or_another_user_account_on_the_same_machine.29|here]], but with the folders listed above, you will be able to import things back into Kontact if necessary.

= Failed Migration =
If you have already attempted to run the migrator and it failed, you can re-run it manually by first deleting your ~/.kde4/share/config/kmail-migratorrc file and your ~/.kde4/share/config/kmail2rc file. Then you will need to run the migrator manually by hitting Alt-F2, and entering the following:

''kmail-migrator --interactive''
The program will run, and all your accounts and mails will be moved over to the Akonadi system. 

= After Migrating =
When KMail2 opens, you will notice a few things:

 * Your accounts will no longer have the personalized names you have assigned to them. You can edit these from KMail's accounts section under Settings -> Configure Kmail.
 * Email filters are not transferred.
 * Spam Filtering does not automatically move mail to the selected spam folder.
 * On some disconnected (cached) IMAP accounts, many error popups may occur, though the mail is updated properly. Switching off disconnected mode does not fix the issue, but deleting the account and recreating it as a normal IMAP account should clear the error messages. (Bug:872478).
 * Mail in your Local Folders (and others) may not appear initially. You may have to right-click on the Local Folders icon and select "Update folder and it's subfolders", or wait until Kmail refreshes itself.

= Importing Email Manually =
If you choose to skip the migration and enter your account information manually, it is very easy to import your saved KMail folders. 

Go to File -> Import Messages.
In the dialog that opens, select "Import KMail Maildirs and Folder Structure", and browse to where you backed up your ~/.kde/share/apps/kmail folder. Follow the prompts to finish the process. 
If you have mail folders in a different format than the standard Kmail Maildir, choose the appropriate option in the Import dialog.

If you need to import your calendar, you would go to Kontact's Calendar section, select File -> Import -> Import calendar, and browse to where you saved your ~/.kde/share/apps/korganizer and select the std.ics file there, as well as any others  you may have.

For contacts, the process is similar: go to Contacts, then File -> Import -> Import vcard , and browse to where you saved ~/.kde/share/apps/kabc, and select std.vcf, as well as any other .vcf file you may have.
